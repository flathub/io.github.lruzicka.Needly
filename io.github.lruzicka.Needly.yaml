app-id: io.github.lruzicka.Needly
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: needly

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --filesystem=home
  - --filesystem=xdg-run/gvfs
  - --filesystem=xdg-run/libvirt:ro
  - --filesystem=/run/libvirt:ro
  - --system-talk-name=org.libvirt.libvirtd

modules:
  - name: tcl
    buildsystem: autotools
    subdir: unix
    post-install:
      - chmod 755 /app/lib/libtcl*.so
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tcl8.6.14-src.tar.gz
        sha256: 5880225babf7954c58d4fb0f5cf6279104ce1cd6aa9b71e9a6322540e1c4de66

  - name: tk
    buildsystem: autotools
    subdir: unix
    config-opts:
      - --with-tcl=/app/lib
    post-install:
      - chmod 755 /app/lib/libtk*.so
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/tcl/tk8.6.14-src.tar.gz
        sha256: 8ffdb720f47a6ca6107eac2dd877e30b0ef7fac14f3a84ebbd0b3612cee41a94

  - name: libtirpc
    config-opts:
      - --disable-gssapi
      - --libdir=/app/lib
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/sourceforge/libtirpc/libtirpc-1.3.4.tar.bz2
        sha256: 1e0b0c7231c5fa122e06c0609a76723664d068b0dba3b8219b63e6340b347860

  - name: rpcsvc-proto
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/thkukuk/rpcsvc-proto/archive/v1.4.4.tar.gz
        sha256: 7988641deae8463303b6273d7af98ece09111c385d4c9134a142a5fad3cdfef8

  - name: python-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} flit_core
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d5/ae/09427bea9227a33ec834ed5461432752fd5d02b14f93dd68406c91684622/flit_core-3.10.1.tar.gz
        sha256: 66e5b87874a0d6e39691f0e22f09306736b633548670ad3c09ec9db03c5662f7

  - name: python-docutils
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} docutils --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/1f/53/a5da4f2c5739cf66290fac1431ee52aff6851c7c8ffd8264f13affd7bcdd/docutils-0.21.2.tar.gz
        sha256: 3a6b18732edf182daa3cd12775bbb338cf5691468f91eeeb109deff6ebfa986f

  - name: libvirt
    buildsystem: meson
    config-opts:
      - --localstatedir=/var
      - -Ddriver_qemu=disabled
      - -Ddriver_openvz=disabled
      - -Ddriver_lxc=disabled
      - -Ddriver_vbox=disabled
      - -Ddriver_libxl=disabled
      - -Ddriver_esx=disabled
      - -Ddriver_hyperv=disabled
      - -Ddriver_vmware=disabled
    sources:
      - type: archive
        url: https://libvirt.org/sources/libvirt-10.9.0.tar.xz
        sha256: 2473db10bb9b9992c02897cef4b26ae58885ff357cea5f9ce3ec9e008f6b5b3a

  - name: python3-dependencies
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} Pillow libvirt-python --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a5/26/0d95c04c868f6bdb0c447e3ee2de5564411845e36a858cfd63766bc7b563/pillow-11.0.0.tar.gz
        sha256: 72bacbaf24ac003fea9bff9837d1eedb6088758d41e100c1552930151f677739
      - type: file
        url: https://files.pythonhosted.org/packages/e3/ed/b9b4b68c909fb91ef806d74c65ce563a792a2b1a95715fc284a4a473dff9/libvirt-python-11.0.0.tar.gz
        sha256: cee825a53c6438c5bc84b4250b35493a8e504d5d8075d3d2069ffaf7090846f8

  - name: needly
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} needly
      - install -Dm644 io.github.lruzicka.Needly.png /app/share/icons/hicolor/128x128/apps/io.github.lruzicka.Needly.png
      - install -Dm644 io.github.lruzicka.Needly.desktop /app/share/applications/io.github.lruzicka.Needly.desktop
      - install -Dm644 io.github.lruzicka.Needly.metainfo.xml /app/share/metainfo/io.github.lruzicka.Needly.metainfo.xml
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/38/a2/be0e52dcf41d03b5446514809560102eb5286a3a51349b14dbd0a272e366/needly-2.5.95-py3-none-any.whl
        sha256: f9f82cd596901d57cc29ef6ea7d24333cf76f6c8cdcea2551b247306bf14c525
      - type: file
        path: io.github.lruzicka.Needly.png
      - type: file
        path: io.github.lruzicka.Needly.desktop
      - type: file
        path: io.github.lruzicka.Needly.metainfo.xml
